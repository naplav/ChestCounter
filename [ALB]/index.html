
    <!DOCTYPE html>
    <html lang="it">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>[ALB] Chest Counter</title>

        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

        <!-- DataTables CSS -->
        <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">

        <style>
            body {
                background-color: #f8f9fa;
            }
            .container {
                margin-top: 100px;
                max-width: 100%;
            }
            .card {
                border-radius: 10px;
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            }
            .table-responsive {
                overflow-x: auto;
                width: 100%;
            }
            #dataTable {
                width: 100% !important;
            }
            .total-row {
                font-weight: bold !important;
                background-color: #ffc107 !important;  /* Sfondo giallo */
            }
            .dataTables_wrapper .dataTables_scrollBody {
                max-height: 70vh !important;
                overflow-y: auto !important;
            }
        </style>
    </head>
    <body>

        <!-- Navbar -->
        <nav class="navbar navbar-dark bg-dark fixed-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">[ALB] Chest Counter</a>
            </div>
        </nav>

        <!-- Contenitore principale -->
        <div class="container">
            <div class="card p-4">
                <h2 class="text-center">[ALB] Chest Counter</h2>
                <p class="text-center">Last update: 2025-02-14 04:16:55</p>
                <div class="table-responsive">
                    <table id="dataTable" class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>player</th>
<th>Total Points</th>
<th>C-INDEX</th>
<th>Total Chests</th>
<th>EC 20+</th>
<th>Arachne</th>
<th>Bank Bronze Chest</th>
<th>Bank Golden Chest</th>
<th>Bank Precious Chest</th>
<th>Bank Silver Chest</th>
<th>Bank Wooden Chest</th>
<th>CC10</th>
<th>CC15</th>
<th>CC20</th>
<th>CC25</th>
<th>CC5</th>
<th>CT10</th>
<th>CT15</th>
<th>CT20</th>
<th>CT25</th>
<th>CT30</th>
<th>EC15</th>
<th>EC20</th>
<th>EC25</th>
<th>EC30</th>
<th>EC35</th>
<th>Heroic 16-20</th>
<th>Heroic 21-25</th>
<th>Heroic 26-30</th>
<th>Heroic 41-45</th>
<th>Others</th>
<th>RC10</th>
<th>RC15</th>
<th>RC20</th>
<th>RC25</th>
<th>RC30</th>
<th>Triumph</th>
<th>Vault</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- I dati verranno inseriti qui dinamicamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- jQuery e DataTables -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            $(document).ready(function() {
                fetch('https://script.google.com/macros/s/AKfycbxfGNfclEInb8y6vNH9EuX-mJRyatqBj1HC_BkM3NGizZWJvPXrlnLfI1xI6D3unpMS/exec')
                    .then(response => response.json())
                    .then(data => {
                        var table = $('#dataTable').DataTable({
                            data: data.data,
                            columns: [{ data: "player" },
{ data: "Total Points" },
{ data: "C-INDEX" },
{ data: "Total Chests" },
{ data: "EC 20+" },
{ data: "Arachne" },
{ data: "Bank Bronze Chest" },
{ data: "Bank Golden Chest" },
{ data: "Bank Precious Chest" },
{ data: "Bank Silver Chest" },
{ data: "Bank Wooden Chest" },
{ data: "CC10" },
{ data: "CC15" },
{ data: "CC20" },
{ data: "CC25" },
{ data: "CC5" },
{ data: "CT10" },
{ data: "CT15" },
{ data: "CT20" },
{ data: "CT25" },
{ data: "CT30" },
{ data: "EC15" },
{ data: "EC20" },
{ data: "EC25" },
{ data: "EC30" },
{ data: "EC35" },
{ data: "Heroic 16-20" },
{ data: "Heroic 21-25" },
{ data: "Heroic 26-30" },
{ data: "Heroic 41-45" },
{ data: "Others" },
{ data: "RC10" },
{ data: "RC15" },
{ data: "RC20" },
{ data: "RC25" },
{ data: "RC30" },
{ data: "Triumph" },
{ data: "Vault" },],
                            paging: false,
                            scrollY: "70vh",
                            scrollX: true,
                            scrollCollapse: true,
                            order: []  // Disabilita l'ordinamento automatico
                        });

                        // Funzione di formattazione condizionale
                        table.rows().every(function() {
                            var data = this.data();
                            // Escludi la riga "Total" dalla formattazione
                            if (data["player"] === "Total") {
                                // Rendi la riga "Total" visibile con sfondo giallo
                                $(this.node()).find("td").css("background-color", "#ffc107");  // Giallo
                                $(this.node()).find("td").css("font-weight", "bold");  // Grassetto
                                return;
                            }
                            var cIndex = parseFloat(data["C-INDEX"]);  // Prende il valore di C-INDEX
                            var ec20Plus = parseFloat(data["EC 20+"]);  // Prende il valore di EC 20+

                            if (!isNaN(cIndex)) {
                                // Trova l'indice delle colonne "Total Points" e "C-INDEX"
                                var cIndexCol = $("th").filter(function() { return $(this).text() === "C-INDEX"; }).index();
                                var totalPointsCol = $("th").filter(function() { return $(this).text() === "Total Points"; }).index();

                                // Applica i colori in base al valore di C-INDEX
                                var color = "";
                                if (cIndex > 1) color = "#d4edda";  // Verde chiaro
                                else if (cIndex < 0.9) color = "#f8d7da";  // Rosso chiaro
                                else color = "#fff3cd";  // Giallo chiaro

                                // Colora le celle corrispondenti
                                $(this.node()).find("td").eq(cIndexCol).css("background-color", color);
                                $(this.node()).find("td").eq(totalPointsCol).css("background-color", color);
                            }

                            // Formattazione condizionale per la colonna EC 20+
                            if (!isNaN(ec20Plus)) {
                                var ec20Col = $("th").filter(function() { return $(this).text() === "EC 20+"; }).index();

                                // Calcola la media
                                var lowerBound = 0.5 * 21.476744186046513;
                                var upperBound = 0.75 * 21.476744186046513;

                                var ecColor = "";
                                if (ec20Plus > upperBound) ecColor = "#d4edda";  // Verde chiaro
                                else if (ec20Plus < lowerBound) ecColor = "#f8d7da";  // Rosso chiaro
                                else ecColor = "#fff3cd";  // Giallo chiaro

                                // Colora la cella EC 20+
                                $(this.node()).find("td").eq(ec20Col).css("background-color", ecColor);
                            }
                        });
                    });
            });
        </script>
    </body>
    </html>
    