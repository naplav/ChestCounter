
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chest Counter</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">

    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            margin-top: 100px;
        }
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .total-row {
            background-color: #ff9800 !important;  /* Arancione vivace per il Total */
            font-weight: bold;
            color: white;  /* Testo bianco per contrastare con lo sfondo arancione */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);  /* Ombra pi√π marcata */
            border: 2px solid #e65100;  /* Bordo arancione scuro per evidenziarla */
        }
        .dataTables_wrapper .dataTables_scrollBody {
            max-height: 70vh !important;
            overflow-y: auto !important;
        }
    </style>
</head>
<body>

    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">[ALB] Chest Counter</a>
        </div>
    </nav>

    <!-- Contenitore principale -->
    <div class="container">
        <div class="card p-4">
            <h2 class="text-center">[ALB] Chest Counter</h2>
            <div class="table-responsive">
                <table id="dataTable" class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            <th>player</th>
<th>Total Points</th>
<th>C-INDEX</th>
<th>Total Chests</th>
<th>EC 20+</th>
<th>Arachne</th>
<th>Bank Bronze Chest</th>
<th>Bank Golden Chest</th>
<th>Bank Silver Chest</th>
<th>Bank Wooden Chest</th>
<th>CC10</th>
<th>CC15</th>
<th>CC20</th>
<th>CC25</th>
<th>CC5</th>
<th>CT10</th>
<th>CT15</th>
<th>CT20</th>
<th>CT25</th>
<th>CT30</th>
<th>EC15</th>
<th>EC20</th>
<th>EC25</th>
<th>EC30</th>
<th>EC35</th>
<th>Heroic 16-20</th>
<th>Heroic 21-25</th>
<th>Heroic 26-30</th>
<th>Heroic 41-45</th>
<th>Others</th>
<th>RC10</th>
<th>RC15</th>
<th>RC20</th>
<th>RC25</th>
<th>RC30</th>
<th>Triumph</th>
<th>Vault</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- I dati verranno inseriti qui dinamicamente -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- jQuery e DataTables -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        $(document).ready(function() {
            fetch('https://script.google.com/macros/s/AKfycbzZyEv9E5AIb5DOGkkj3mqBRiCRTR3hcjVO_seMONIrgrqn5hb_MrDCY3XyfJzIVWSg/exec')
                .then(response => response.json())
                .then(data => {
                    var table = $('#dataTable').DataTable({
                        data: data.data,
                        columns: [{ data: "player" },
{ data: "Total Points" },
{ data: "C-INDEX" },
{ data: "Total Chests" },
{ data: "EC 20+" },
{ data: "Arachne" },
{ data: "Bank Bronze Chest" },
{ data: "Bank Golden Chest" },
{ data: "Bank Silver Chest" },
{ data: "Bank Wooden Chest" },
{ data: "CC10" },
{ data: "CC15" },
{ data: "CC20" },
{ data: "CC25" },
{ data: "CC5" },
{ data: "CT10" },
{ data: "CT15" },
{ data: "CT20" },
{ data: "CT25" },
{ data: "CT30" },
{ data: "EC15" },
{ data: "EC20" },
{ data: "EC25" },
{ data: "EC30" },
{ data: "EC35" },
{ data: "Heroic 16-20" },
{ data: "Heroic 21-25" },
{ data: "Heroic 26-30" },
{ data: "Heroic 41-45" },
{ data: "Others" },
{ data: "RC10" },
{ data: "RC15" },
{ data: "RC20" },
{ data: "RC25" },
{ data: "RC30" },
{ data: "Triumph" },
{ data: "Vault" },],
                        paging: false,
                        scrollY: "70vh",
                        scrollX: true,
                        scrollCollapse: true,
                        order: []  // Disabilita l'ordinamento automatico
                    });

                    // Funzione di formattazione condizionale
                    table.rows().every(function() {
                        var data = this.data();
                        // Escludi la riga "Total" dalla formattazione
                        if (data["player"] === "Total") {
                            return;
                        }
                        var cIndex = parseFloat(data["C-INDEX"]);  // Prende il valore di C-INDEX

                        if (!isNaN(cIndex)) {
                            // Trova l'indice delle colonne "Total Points" e "C-INDEX"
                            var cIndexCol = $("th").filter(function() { return $(this).text() === "C-INDEX"; }).index();
                            var totalPointsCol = $("th").filter(function() { return $(this).text() === "Total Points"; }).index();

                            // Applica i colori in base al valore di C-INDEX
                            var color = "";
                            if (cIndex > 1) color = "#d4edda";  // Verde chiaro
                            else if (cIndex < 0.9) color = "#f8d7da";  // Rosso chiaro
                            else color = "#fff3cd";  // Giallo chiaro

                            // Colora le celle corrispondenti
                            $(this.node()).find("td").eq(cIndexCol).css("background-color", color);
                            $(this.node()).find("td").eq(totalPointsCol).css("background-color", color);
                        }

                        // Formattazione condizionale per "EC 20+" (nuove regole)
                        var ec20plusValue = parseFloat(data["EC 20+"]);
                        if (!isNaN(ec20plusValue)) {
                            var ec20plusCol = $("th").filter(function() { return $(this).text() === "EC 20+"; }).index();

                            // Calcola la media della colonna EC 20+
                            var total = parseFloat(data["Total"]);
                            var rowsCount = table.rows().count() - 1;  // Escludi la riga Total
                            var ec20plusAverage = total / rowsCount;

                            // Applica i colori in base al valore di EC 20+
                            var ecColor = "";
                            if (ec20plusValue > 0.75 * ec20plusAverage) ecColor = "#d4edda";  // Verde chiaro
                            else if (ec20plusValue < 0.5 * ec20plusAverage) ecColor = "#f8d7da";  // Rosso chiaro
                            else ecColor = "#fff3cd";  // Giallo chiaro

                            // Colora la cella corrispondente per "EC 20+"
                            $(this.node()).find("td").eq(ec20plusCol).css("background-color", ecColor);
                        }
                    });
                });
        });
    </script>
</body>
</html>
